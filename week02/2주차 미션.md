# 2주차 미션

## 1. 내가 진행중, 진행 완료한 미션 모아서 보는 쿼리(페이징 포함)
#### user_mission 테이블의 created_at과 id를 커서로 사용.

#### 첫 페이지 조회 시
```sql
SELECT
    s.name AS store_name,
    m.reword,
    m.spac AS mission_condition,
    um.status AS is_completed,
    um.created_at,
    um.id
FROM
    user_mission AS um
JOIN
    mission AS m ON um.mission_id = m.id
JOIN
    store AS s ON m.store_id = s.id
WHERE
    um.user_no = "유저ID" AND um.status = "STATUS"
ORDER BY
    um.created_at DESC, um.id DESC
LIMIT 10
```

#### 다음 페이지 조회 시
```sql
SELECT
    s.name AS store_name,
    m.reword,
    m.spac AS mission_condition,
    um.status AS is_completed,
    um.created_at,
    um.id
FROM
    user_mission AS um
JOIN
    mission AS m ON um.mission_id = m.id
JOIN
    store AS s ON m.store_id = s.id
WHERE
    um.user_no = "유저ID" AND um.status = "STATUS"
    AND (um.created_at, um.id) < ("마지막created_at 값", "마지막ID값")
ORDER BY
    um.created_at DESC, um.id DESC
LIMIT 10;
```

## 2. 리뷰 작성하는 쿼리
```sql
INSERT INTO store_review (profile_id, store_id, starRating, text, created_at, updated_at)
VALUES ("사용자의 프로필 ID", "리뷰를 작성할 가게 ID", "별점", "리뷰 내용", NOW(), NOW());
```

## 3. 홈 화면 쿼리 (현재 선택 된 지역에서 도전이 가능한 미션 목록, 페이징 포함)
#### mission 테이블의 deadline, created_at, id를 커서로 사용.

### 1. 현재 지역 미션 달성 현황
```sql
SELECT
    COUNT(um.id) % 10 AS mission_progress_count
FROM
    user_mission AS um
JOIN
    mission AS m ON um.mission_id = m.id
JOIN
    store AS s ON m.store_id = s.id
WHERE
    um.user_no = "유저ID"
    AND s.region_id = "지역ID"
    AND um.status = TRUE;
```
### 2. 도전 가능한 미션 목록
#### 첫 페이지 조회 시
```sql
SELECT
    s.name AS store_name,
    s.industry,
    m.spac AS mission_condition,
    m.reword,
    m.deadline,
    m.created_at,
    m.id
FROM
    mission AS m
JOIN
    store AS s ON m.store_id = s.id
WHERE
    s.region_id = "지역ID"
    AND m.deadline > NOW()
    AND NOT EXISTS (
        SELECT 1
        FROM user_mission um
        WHERE um.mission_id = m.id AND um.user_no = "유저ID"
    )
ORDER BY
    m.deadline ASC, m.created_at DESC, m.id DESC
LIMIT 10;
```

#### 다음 페이지 조회 시
```sql
SELECT
    s.name AS store_name,
    s.industry,
    m.spac AS mission_condition,
    m.reword,
    m.deadline,
    m.created_at,
    m.id
FROM
    mission AS m
JOIN
    store AS s ON m.store_id = s.id
WHERE
    s.region_id = "지역ID"
    AND m.deadline > NOW()
    AND NOT EXISTS (
        SELECT 1
        FROM user_mission um
        WHERE um.mission_id = m.id AND um.user_no = "유저ID"
    )
    AND (
        (m.deadline > "마지막deadline값") OR
        (m.deadline = "마지막deadline값" AND m.created_at < "마지막created_at값") OR
        (m.deadline = "마지막deadline값" AND m.created_at = "마지막created_at값" AND m.id < "마지막ID값")
    )
ORDER BY
    m.deadline ASC, m.created_at DESC, m.id DESC
LIMIT 10;
```

## 4. 마이 페이지 화면
```sql
SELECT
    p.nickname,
    p.image_url,
    u.email,
    u.cell_phone,
    u.is_verified,
    u.Point
FROM
    user AS u
JOIN
    profile AS p ON u.id = p.user_no
WHERE
    u.id = "사용자ID";
```